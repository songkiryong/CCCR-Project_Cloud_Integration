<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel='stylesheet' href="static/css/style.css">
    <title>강약 중강약</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.809.0.min.js"></script>
    <style>
/*         
        @media screen and (max-width: 769px) {
            .header {height: 100px;}
            #logo_img {width: 200px; height: 100px;}
            .td_title {font-size:11px;}
        } */
        

    </style>
</head>
<body> 
    <div class="header">
        <a href="mainsite.html"> <img id="logo_img" src='static/images/logo11.jpg' width="250px" height="130px"/> </a>
    </div>
    <div class="">        
    <form name="main_form" method="post" enctype="multipart/form-data" action="/post">
        <img width="14px;" src='static/images/pill.png'/><span class="span_title">알약정보 입력</span>
         <div style="position:relative">
            <input type="file" name="pill_file" id="files" onchange="fileCheck(this)" accept=".jpg, .png"/>
            <button type="submit", id="button" class="btn_submit btn_file", value="Button"> 제출</button>
            <script src="putFile.js"></script>
            <script src="index.js"></script>
        </div>

        <div id="div_preview" style="text-align: center;">
            <img name="preview" width="300px;" style="max-width:100%; margin-top: 5px;" /></br>
        </div>
    </form>
    </div>

    <div style="margin-top: 10px;">
        <img width="14px;" src='static/images/pill.png'/><span class="span_title">결과화면</span>
        <iframe id="result_frame" src="" frameborder=0 width="100%" height="420px" style="border:1px solid #848484"></iframe>
    </div>
    <div class="pop_wrap" id="notice_popup">
        <div class="pop_header">
            <button type="button" onclick="closePopUp()">닫기</button>
        </div>
        <div class="pop_body">
            <img src='static/images/pop0000.jpg' width="100%"/>
        </div>
    </div>
    <footer>
        <div class = "team" style="text-align: left; float : left"><p>2021-1학기  </br>캡스톤 디자인팀 강약중강약</p></div>
        <div class = "add"  style="text-align: right;"><p>(24252) 강원도 춘천시 한림대학길 1 </br>빅데이터전공 김한나 송기룡 윤소영 윤수정 함서은</p></div>
    </footer>
</body>
<script type="text/javascript">
    //팝업닫기
    function closePopUp() {
        document.getElementById("notice_popup").style.display = "none";
    }

    //제출
    function doSubmit() {
        var frm = document.main_form;

        if (frm.pill_file.value == "") {
            alert("파일을 첨부해주세요");
            return;
        }
        document.getElementById("result_frame").src = "result.html";
    }    


    /*
    * 파일이 변경되었을 때 호출되며, 파일검사
    * @param file : 업로드한 파일 정보
    */
    function fileCheck(file){
        var frm = document.main_form;
        var file_name = file.value;                                      //사용자가 첨부한 파일명
        var file_ext = file_name.substring(file_name.lastIndexOf('.'));  //사용자가 첨부한 파일확장자 (검사용)
        var max_byte = 10 * 1024 * 1024; // 10MB
    
        //사전체크 : 사용자가 업로드한 파일이 없으면 검사종료
        if (file_name == ""){
            frm.preview.src = ""                        //미리보기 이미지 초기화
            return;                                     //검사종료
        }
        
        var file_size = file.files[0].size;                              //사용자가 첨부한 파일크기

        if(file_size > max_byte) {
            alert("10MB를 초과하였습니다.");
            file.value = ""                             //사용자가 업로드한 파일을 초기화
            frm.preview.src = ""                        //미리보기 이미지 초기화
            return;
        }

        if (file_ext == ".jpg" || file_ext == ".png"){  //.jpg랑 .png만 업로드 가능

            //FileReader 객체는 서버에 이미지 업로드 안해도 미리보기 기능 구현 가능
			// 필수스펙 : Explorer 10이상 / Chrome 7이상 / Edge 12이상
			var reader = new FileReader();

			reader.onload = function (e) {              //사용자가 업로드한 파일을 읽어오면
                frm.preview.src = e.target.result       //미리보기 이미지 변경
			}
            reader.readAsDataURL(file.files[0])

        } else {
            alert("허용된 파일이 아님");
            file.value = ""                             //사용자가 업로드한 파일을 초기화
            frm.preview.src = ""                        //미리보기 이미지 초기화
        }
    }
</script>
</html>